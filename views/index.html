<!DOCTYPE html>
<html>
  <head>
    <title>{{title}}</title>
      <link rel='stylesheet' href='/stylesheets/bootstrap.css' />
      <script src="/javascripts/jquery-1.9.1.js"></script>
      <script src="/javascripts/bootstrap.js"></script>
      <script src="/javascripts/bootbox.min.js"></script>
  </head>
  <body>
    <div class="row">
        <div class="col-md-4 col-md-offset-4">
           <h1> Message Board</h1>
        </div>
    </div>
    <div class="row col-md-12 col-md-offset-1">
        <form id="commentForm" class="form-inline" role="form">
            <div class="form-group col-md-2">
                <input type="text" class="form-control" id="name" placeholder="email address or name">
            </div>
            <div class="form-group col-md-6 ">
                <input type="text" class="form-control" id="comment" placeholder="comment">
            </div>
            <button type="submit" class="btn btn-primary">submit</button>
        </form>
    </div>
    <p>
       <div class="row col-md-8 col-md-offset-1">
            <ul class="list-group">
                {%for comment in comments %}
                <li class="list-group-item">
                    <span class="reply pull-right">
                        <button type="button" class="btn btn-info">reply</button>
                    </span>
                    <ul class="list-unstyled">
                        <li>{{comment.content}}</li>
                        <li>{{comment.createTime|date("Y-n-d H:i") }} <a href="#">@{{comment.username}}</a></li>
                     </ul>
                </li>
                {% endfor %}
            </ul>
        </div>
    </p>
  </body>
  <script type="text/javascript">
      $( ".btn.btn-primary" ).click(function( ) {
          if($("#comment").val() == ""){
              bootbox.dialog({
                  message: '写点东西吧，评论内容不能为空哦。',
                  title: "提示",
                  backdrop:false,
                  buttons: {
                      main: {
                          label: "OK!",
                          className: "btn-primary"
                      }
                  }
              });
              return false;
          }
          $.ajax({
              type: "POST",
              url: '/comment/create',
              data: {
                  "name" :$("#name").val(),
                  "comment":$("#comment").val()
              }, // serializes the form's elements.
              success: function(data)
              {
//                  $("#name").val("");
//                  $("#comment").val("");
                  if(data){
                      bootbox.dialog({
                          message: '发表评论成功。',
                          title: "提示",
                          backdrop:false,
                          buttons: {
                              main: {
                                  label: "OK!",
                                  className: "btn-primary"
                              }
                          }
                      });
                  }else{
                      bootbox.dialog({
                          message: '发表评论失败，好像有什么东西混进来了。',
                          title: "提示",
                          backdrop:false,
                          buttons: {
                              main: {
                                  label: "OK!",
                                  className: "btn-primary"
                              }
                          }
                      });
                  }
              }
          });
          return false;
      });

      $( ".btn.btn-info" ).click(function( ) {
          $current_ul = $(this).parent().parent("li").children("ul");
          if($current_ul.children().has("form").length <= 0){
              $current_ul.append('<li>'+
              '<div class="row col-md-12">'+
              '<form class="form-inline" role="form">'+
              '<div class="form-group col-md-2">'+
              '<input type="text" class="form-control" id="r_name" placeholder="email address or name">'+
              '</div>'+
              '<div class="form-group col-md-9 ">'+
              '<input type="text" class="form-control" id="r_comment" placeholder="reply comment">'+
              '</div>'+
              '<button type="submit" class="btn btn-default">reply</button>'+
              '</form>'+
              '</div>'+
              '</li>');
          };
          return false;
      });
      $("body").on("click", '.btn.btn-default', function(){
          $.ajax({
              type: "POST",
              url: '/reply/create',
              data: {
                  "name" :$("#r_name").val(),
                  "comment":$("#r_comment").val()
              }, // serializes the form's elements.
              success: function(data)
              {
                  alert(data); // show response from the php script.
              }
          });
          return false;
      });
  </script>
</html>